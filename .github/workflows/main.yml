name: RDP-Final-Success
on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: Setup User and RDP
        run: |
          net user SMMExpert Pass123 /add
          net localgroup administrators SMMExpert /add
          reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
          powershell Enable-NetFirewallRule -DisplayGroup "'Remote Desktop'"

      - name: Download Cloudflared Portable
        run: |
          # Portable file download karna jo direct chalti hai
          curl.exe -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe -o cloudflared.exe

      - name: Start Tunnel (Direct Path)
        shell: powershell
        run: |
          # Seedha isi folder se cloudflared chalana
          Start-Process -FilePath ".\cloudflared.exe" -ArgumentList "tunnel --url rdp://localhost:3389" -RedirectStandardOutput "tunnel_log.txt"
          Start-Sleep -Seconds 30
          $log = Get-Content "tunnel_log.txt" | Select-String "trycloudflare.com"
          if ($log) {
              Write-Host "----------------------------------------------------"
              Write-Host "Aapka RDP Address ye hai: $($log.Matches.Value)"
              Write-Host "----------------------------------------------------"
          } else {
              Write-Host "Address nahi mila, logs check karein:"
              Get-Content "tunnel_log.txt"
          }
          Start-Sleep -Seconds 21600
